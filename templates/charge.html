<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8" />
    <title>Cobrança Pix Gerada</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 600px; margin: auto; padding: 20px; }
        .qr-code { text-align: center; margin-bottom: 20px; }
        input, button { font-size: 1.2em; width: 100%; padding: 10px; margin-bottom: 10px; }
        .info { margin-bottom: 15px; }
        .timer { font-weight: bold; color: green; }
        .test-label { color: red; font-weight: bold; margin-bottom: 20px; }
    </style>
</head>
<body>
    <h1>Cobrança Pix Gerada</h1>

    {% if is_test %}
      <div class="test-label">Você está usando <strong>PIX TESTE</strong>. Valor fixo de R$ 5,00.</div>
    {% endif %}

    <div class="qr-code">
        <img src="data:image/png;base64,{{ qr_code_base64 }}" alt="QR Code Pix" />
    </div>

    <div class="info">
        <label for="pix_code">Código Pix (copiar e colar):</label>
        <input type="text" id="pix_code" value="{{ pix_code }}" readonly />
        <button onclick="copyPixCode()">Copiar código Pix</button>
    </div>

    <div class="info">
        <p>Valor bruto: R$ {{ '%.2f' % charge_amount }}</p>
        <p>Taxas totais: R$ {{ '%.2f' % total_commission }}</p>
        <p>Valor líquido: R$ {{ '%.2f' % net_amount }}</p>
    </div>

    <div class="info">
        <p>Este QR Code é válido por <span id="timer">08:00:00</span> horas.</p>
    </div>

    <script>
        function copyPixCode() {
            const pixCodeInput = document.getElementById('pix_code');
            pixCodeInput.select();
            pixCodeInput.setSelectionRange(0, 99999);
            document.execCommand('copy');
            alert('Código Pix copiado!');
        }

        // Contador regressivo para 8 horas (28800 segundos)
        let timeLeft = 28800; // 8 horas em segundos

        function startTimer() {
            const timerElement = document.getElementById('timer');

            const interval = setInterval(() => {
                if (timeLeft <= 0) {
                    clearInterval(interval);
                    timerElement.textContent = 'Expirado';
                    return;
                }

                let hours = Math.floor(timeLeft / 3600);
                let minutes = Math.floor((timeLeft % 3600) / 60);
                let seconds = timeLeft % 60;

                timerElement.textContent = 
                    String(hours).padStart(2, '0') + ':' +
                    String(minutes).padStart(2, '0') + ':' +
                    String(seconds).padStart(2, '0');

                timeLeft--;
            }, 1000);
        }

        startTimer();
    </script>
</body>
</html>
